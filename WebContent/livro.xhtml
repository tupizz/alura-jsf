<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	

<ui:composition template="_template.xhtml">
	<ui:define name="titulo">
		Novo Livro
	</ui:define>
	
	<ui:define name="conteudo">
	
		<h:form id="formLivro">
			
			<!-- Mensagens de erro -->
			<h:messages id="messages"/>
			
			<fieldset>
				<legend>Dados do Livro</legend>
				<h:panelGrid columns="3">
	
					<h:outputLabel value="Titulo:" for="titulo" />
					<h:inputText id="titulo" value="#{livroBean.livro.titulo}" required="true" 
						requiredMessage="O campo título deve ser preenchido!" validatorMessage="O campo deve ser menor que 40 caracteres!">
						<f:validateLength maximum="60"/>
						<f:ajax event="blur" render="tituloMessage"/>
					</h:inputText>
					<h:message for="titulo" id="tituloMessage"/>
	
					<h:outputLabel value="ISBN:" for="isbn" />
					<h:inputText id="isbn" value="#{livroBean.livro.isbn}" validator="#{livroBean.comecaComDigitoUm}">
						<f:ajax event="keyup" render="isbnMessage"/>
					</h:inputText>
					<h:message for="isbn" id="isbnMessage"/>
	
					<h:outputLabel value="Preço:" for="preco" />
					<h:inputText id="preco" value="#{livroBean.livro.preco}" label="Preço">
						<f:validateDoubleRange minimum="1.0" maximum="1000.00" />
						<f:convertNumber type="currency" pattern="R$ #0.00" currencySymbol="R$" locale="pt_BR"/>
						<f:ajax event="blur" render="precoMessage"/>
					</h:inputText>
					<h:message for="preco" id="precoMessage"/>
					
	
					<h:outputLabel value="Data de Lançamento:" for="dataLancamento" />
					<h:inputText id="dataLancamento" value="#{livroBean.livro.dataLancamento.time}">
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
						<f:ajax event="blur" render="dataMessage"/>
					</h:inputText>
					<h:message for="dataLancamento" id="dataMessage"/>
					
	
				</h:panelGrid>
			</fieldset>
			
			<fieldset>
			
				<legend>Informações do Autor</legend>
				
				<!-- COMBO BOX DE AUTORES DO SISTEMA -->
				<h:outputLabel value="Selecioneo autor:" for="autor" />
				<h:selectOneMenu value="#{livroBean.autorId}" id="autor">
					<f:selectItems value="#{livroBean.autores}" var="autor" itemLabel="#{autor.nome}" itemValue="#{autor.id}"/>
				</h:selectOneMenu>
				
				<!-- BTN GRAVAR AUTOR COM FUNÇÃO AJAX -->
				<h:commandButton value="Gravar Autor" action="#{livroBean.gravarAutor}" >
					<!-- execute: campos enviados como atributos na requisição em ajax -->
					<f:ajax execute="autor" render="autores"/>
				</h:commandButton>
				
				
				<br/>
				
				<!-- LINK PARA PÁGINA DE ADIÇÃO DE AUTORES -->
				<h:commandLink value="Cadastrar novo Autor" action="#{livroBean.formAutor}" immediate="true"/>
				
				<!-- LISTA DE AUTORES REFERENTES AO LIVRO CADASTRADO -->
				<h:dataTable value="#{livroBean.autoresDoLivro}" var="autor" id="autores">
					<h:column>
						<h:outputText value="#{autor.nome}"/>
					</h:column>
					<h:column>
						<h:commandLink value="X" action="#{livroBean.excluirAutorDoLivro(autor)}">
			            		<f:ajax render="@form" />
			           	</h:commandLink>
					</h:column>
				</h:dataTable>
				
			</fieldset>
	
			<h:commandButton value="Gravar " action="#{livroBean.gravar}" > 
			
				<!-- @form // @all // @this o que deseja ser att dos objetos 
					 :<nome_do_id> caminho absoluto para encontrar o ID -->
					 
				<f:ajax execute="@form" render="@form :formTabelaLivros:tabelaLivros"/>
			</h:commandButton>
		
		</h:form>
		
		
		<!-- Lista de todos os Livros Cadastrados -->
		<h:form id="formTabelaLivros">
		
				<h:dataTable value="#{livroBean.livros}" var="livro" id="tabelaLivros">
			            <h:column>
			                <f:facet name="header">Titulo</f:facet>
			                <h:outputText value="#{livro.titulo}" />
			            </h:column>
			            <h:column>
			                <f:facet name="header">ISBN</f:facet>
			                <h:outputText value="#{livro.isbn}" />
			            </h:column>
			            <h:column>
			                <f:facet name="header">Preço</f:facet>
			                <h:outputText value="#{livro.preco}" />
			            </h:column>
			            <h:column>
			            	<f:facet name="header">Data Lançamento</f:facet>
			            	<h:outputText value="#{livro.dataLancamento.time}">
			            		<f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
			            	</h:outputText>
			            </h:column>
			            <h:column>
			            	<f:facet name="header">Remover</f:facet>
			            	<h:commandLink value="Excluir" action="#{livroBean.excluir(livro)}">
			            		<f:ajax render="@form"/>
			            	</h:commandLink>
			            </h:column>
			            <h:column>
			            	<f:facet name="header">Alterar</f:facet>
			            	<h:commandLink value="Alterar" action="#{livroBean.carregarFormulario(livro)}">
			            	
			            		<!-- como já estamos passando o livro por argumento não precisa de execute! -->
			            		<f:ajax render="@form :formLivro"/>
			            		
			            	</h:commandLink>
			            </h:column>
			 	</h:dataTable>
			 	
		</h:form>
		
	
	</ui:define>
	
	<ui:define name="txt-rodape">
	  Cadastro de Livros
	</ui:define>
        
</ui:composition>

</html>